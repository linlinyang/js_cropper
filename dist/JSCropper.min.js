!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).JSCropper=t()}(this,function(){"use strict";var t=Object.prototype.toString;function a(e){return{"[object Object]":"object","[object Array]":"array","[object Number]":"number","[object Boolean]":"boolean","[object String]":"string","[object Function]":"function","[object Undefined]":"undefined","[object Null]":"null"}[t.call(e)]}var c=Object.prototype.hasOwnProperty;function d(e,t){var o=e[t];"function"==typeof o&&o.call(e)}"function"!==a(Object.assign)&&Object.defineProperty(Object,"assign",{value:function(e){var t=arguments;if(null===r)return r;for(var o=arguments.length,r=Object(e),i=1;i<o;i++){var n=t[i];for(var a in n)c.call(n,a)&&(r[a]=n[a])}return r},writable:!0,configurable:!0,enumerable:!1});var o=1;function g(e,t,o,r){void 0===r&&(r=1);var i=e.getContext("2d"),n=t*r,a=o*r;return e.width=n,e.height=a,i.mozImageSmoothingEnabled=!1,i.webkitImageSmoothingEnabled=!1,i.msImageSmoothingEnabled=!1,i.imageSmoothingEnabled=!1,{zoomWidth:n,zoomHeight:a}}var r=String.prototype.toLowerCase;function i(){throw d(jc,"imgLoaded"),new Error("Load image fail, please check your image")}function f(e,t,o,r,i,n){void 0===n&&(n=!1),n?(e.moveTo(t,o),e.lineTo(t,o+i),e.lineTo(t+r,o+i),e.lineTo(t+r,o),e.lineTo(t,o)):e.rect(t,o,r,i)}function n(e){var t=e.bufferCanvas,o=e._x,r=e._y;void 0!==o&&void 0!==r||function(e){var t=e.width,o=e.height,r=e._zoom,i=e.cropperWidth,n=e.cropperHeight;e._x=(i-t)*r/2,e._y=(n-o)*r/2}(e);var i=t.getContext("2d");i.save(),function(e){var t=e.bufferCanvas,o=e.cropperWidth,r=e.cropperHeight,i=e.width,n=e.height,a=e._x,c=e._y,d=e._zoom,g=e.isDragging,p=t.getContext("2d");p.save(),p.beginPath(),f(p,0,0,o*d,r*d),f(p,a,c,i*d,n*d,!0),p.fillStyle=g?e.selectBackColor:e.inSelectBackColor,p.fill(),p.restore()}(e),function(e){var t=e.bufferCanvas;e.cropperWidth,e.cropperHeight,e.width,e.height,e._x,e._y,e._zoom,t.getContext("2d")}(e),i.restore()}function e(e){this._init(e)}var p,s,u;return e.prototype._init=function(e){var t=this;t._originOpts=e,Object.assign(t,{cropperWidth:800,cropperHeight:600,width:300,height:300,shadowColor:"rgba(0,0,0,0.7)",edgeLineColor:"#fff",edgeLineWidth:3,dashLineColor:"rgba(255,255,255,0.8)",quality:1,imgType:"image/png",inSelectBackColor:"rgba(0,0,0,0.6)",selectBackColor:"rgba(0,0,0,0.2)"},e),t._uid=o++,t._redraw(),d(t,"created")},(p=e).prototype.update=function(e){var t=this;d(t,"beforeUpdate"),0!==Object.keys(e)&&(Object.assign(t,e),t._redraw(),d(t,"updated"))},p.prototype.destroy=function(){d(this,"beforeDestory")},p.prototype.reset=function(){d(this,"beforeReset")},(s=e).prototype._restore=function(){var e=this,t=e.ctx,o=e.cropperWidth*e._zoom,r=e.cropperHeight*e._zoom;e._imageSource=t.getImageData(0,0,o,r)},s.prototype._initCanvas=function(){var e=this;d(e,"beforeCreate");var t,o=e.el;"string"===a(o)?t=document.querySelector(o):"object"===a(o)&&"canvas"===toLowerCase.call(o.nodeName)&&1===o.nodeType&&(t=o),t||((t=document.createElement("canvas")).innerHTML="Your browser does not support canvas");var r=e._zoom,i=e.cropperWidth,n=e.cropperHeight;g(t,i,n,r),t.style.width=i+"px",t.style.height=n+"px",t.parentNode||document.body.appendChild(t),e.canvas=t},s.prototype._offscreenBuffering=function(){var e=this,t=document.createElement("canvas"),o=t.getContext("2d"),r=e._zoom,i=g(t,e.cropperWidth,e.cropperHeight,r),n=i.zoomWidth,a=i.zoomHeight;o.clearRect(0,0,n,a),o.save(),o.fillStyle=e.shadowColor,o.fillRect(0,0,n,a),o.restore(),e.bufferCanvas=t,document.body.appendChild(t)},s.prototype._renderOffScreen=function(){var e=this,t=e.bufferCanvas,o=e.canvas,r=e.cropperWidth,i=e.cropperHeight,n=e._zoom,a=o.getContext("2d"),c=r*n,d=i*n;a.clearRect(0,0,c,d),a.drawImage(t,0,0,c,d,0,0,c,d)},u=null,e.prototype._redraw=function(){var t=this;t._zoom=function(){var e=document.createElement("canvas"),t=e.getContext("2d");return e=null,(window.devicePixelRatio||1)/(t.backingStorePixelRatio||t.webkitBackingStorePixelRadio||t.mozBackingStorePixelRadio||t.msBackingStorePixelRadio||t.oBackingStorePixedRadio||1)}(),t._initCanvas(),t._offscreenBuffering(t),Object.defineProperty(t,"_img",{set:function(e){e!==u&&(t._img=u=e,function(e){var t=e.cropperWidth,o=e.cropperHeight,r=e._zoom,i=e._sourceImg,n=i.width,a=i.height,c=Math.min(t/n,o/a);Object.assign(e,{_imgWidth:n*c*r,_imgHeight:a*c*r})}(t),function(e){var t=e.bufferCanvas,o=e._sourceImg,r=e.cropperWidth,i=e.cropperHeight,n=e._imgWidth,a=e._imgHeight,c=e._zoom,d=o.width,g=o.height,p=(r*c-n)/2,f=(i*c-a)/2;t.getContext("2d").drawImage(o,0,0,d,g,p,f,n,a)}(t),n(t),t._renderOffScreen())},get:function(){return u}}),function(e){var t=e.img||e.image;if(t&&t!==e._img)if(d(e,"beforeImgLoaded"),"string"===a(t)){var o=new Image;o.onload=function(){e._sourceImg=o,e._img=t},o.onerror=i,o.src=t}else"object"===a(t)&&"img"===r.call(t)&&1===t.nodeType?(t.onload=function(){e._sourceImg=t,e._img=t},t.onerror=i):i()}(t)},e.version="1.0.0",e});
