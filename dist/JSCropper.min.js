!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).JSCropper=t()}(this,function(){"use strict";var t=Object.prototype.toString;function i(e){return{"[object Object]":"object","[object Array]":"array","[object Number]":"number","[object Boolean]":"boolean","[object String]":"string","[object Function]":"function","[object Undefined]":"undefined","[object Null]":"null"}[t.call(e)]}function f(e,t,o){var i=e.width,n=(e.height,e.getBoundingClientRect()),r=n.width;n.height;return{x:i/r*(t-n.left),y:i/r*(o-n.top)}}var c=Object.prototype.hasOwnProperty;"function"!==i(Object.assign)&&Object.defineProperty(Object,"assign",{value:function(e){var t=arguments;if(null===i)return i;for(var o=arguments.length,i=Object(e),n=1;n<o;n++){var r=t[n];for(var a in r)c.call(r,a)&&(i[a]=r[a])}return i},writable:!0,configurable:!0,enumerable:!1});var u=[];function o(e,t,o,i){void 0===i&&(i=!1),e.addEventListener(t,o,i),u.push({el:e,type:t,handler:o,options:i})}function p(e){return e.changedTouches?e.changedTouches[0]:e}function s(e,t){return Math.floor(e)+t%2/2}function _(e,t,o,i){void 0===i&&(i=!1);var n=e.lineWidth;i?e.moveTo(s(t,n),s(o,n)):e.moveTo(t,o)}function y(e,t,o,i){void 0===i&&(i=!1);var n=e.lineWidth;i?e.lineTo(s(t,n),s(o,n)):e.lineTo(t,o)}function b(e,t,o,i,n,r,a){void 0===r&&(r=!1),void 0===a&&(a=!1);var c=e.lineWidth,d=t+i,h=o+n;a&&(t=s(t,c),o=s(o,c),d=s(t+i,c),h=s(o+n,c)),r?(e.moveTo(t,o),e.lineTo(t,h),e.lineTo(d,h),e.lineTo(d,o)):(e.moveTo(t,o),e.lineTo(d,o),e.lineTo(d,h),e.lineTo(t,h)),e.closePath()}function w(e,t,o,i,n,r,a){void 0===r&&(r=5),void 0===a&&(a=!1);for(var c=function(e,t,o,i){return Math.sqrt(Math.pow(o-e,2)+Math.pow(i-t,2))}(t,o,i,n),d=Math.floor(c/r),h=(i-t)/d,s=(n-o)/d,u=0;u<d;u++){var g=t+u*h,l=o+u*s;1&u?y(e,g,l,a):_(e,g,l,a)}}function r(e){var t=e.width,o=e.height,i=e._zoom,n=e.cropperWidth,r=e.cropperHeight;e._x=(n-t)*i/2,e._y=(r-o)*i/2}function n(e){var t=e.bufferCanvas,o=e._x,i=e._y;e._zoom;void 0!==o&&void 0!==i||r(e);var n=t.getContext("2d");n.save(),function(e){var t=e.bufferCanvas,o=e.cropperWidth,i=e.cropperHeight,n=e.width,r=e.height,a=e._x,c=e._y,d=e._zoom,h=e.isDragging,s=t.getContext("2d");s.save(),s.beginPath(),b(s,0,0,o*d,i*d),b(s,a,c,n*d,r*d,!0),s.fillStyle=h?e.selectBackColor:e.inSelectBackColor,s.fill(),s.restore()}(e),function(e){var t=e.bufferCanvas,o=e.width,i=e.height,n=e._x,r=e._y,a=e._zoom,c=e.edgeLineColor,d=e.edgeLineWidth,h=t.getContext("2d"),s=o*a,u=i*a;h.strokeStyle=c,h.save(),h.lineWidth=Math.pow(a,2),b(h,n,r,s,u,!1,!0),w(h,n,r+u/3,n+s,r+u/3,5*a,!0),w(h,n,r+2*u/3,n+s,r+2*u/3,5*a,!0),w(h,n+s/3,r,n+s/3,r+u,5*a,!0),w(h,n+2*s/3,r,n+2*s/3,r+u,5*a,!0),h.stroke(),h.restore(),h.save();var g=d*a,l=n-(h.lineWidth=g)/2,f=r-g/2+1,p=n+s+g/2,v=r+u+g/2,m=.1*Math.min(s,u);h.beginPath(),_(h,l,f,!0),y(h,l+m,f,!0),_(h,p-m,f,!0),y(h,p,f,!0),y(h,p,f+m,!0),_(h,p,v-m,!0),y(h,p,v,!0),y(h,p-m,v,!0),_(h,l+m,v,!0),y(h,l,v,!0),y(h,1+l,v-m,!0),_(h,1+l,f+m,!0),y(h,1+l,f-g/2,!0),h.stroke(),h.restore()}(e),n.restore()}function a(e,t){var o=e[t];"function"==typeof o&&o.call(e)}var d={cropperWidth:800,cropperHeight:600,width:300,height:300,shadowColor:"rgba(0,0,0,0.7)",edgeLineColor:"#fff",edgeLineWidth:3,dashLineColor:"rgba(255,255,255,0.8)",quality:1,imgType:"image/png",inSelectBackColor:"rgba(0,0,0,0.6)",selectBackColor:"rgba(0,0,0,0.4)"};var h=1;function g(e,t,o,i){void 0===i&&(i=1);var n=e.getContext("2d"),r=t*i,a=o*i;return e.width=r,e.height=a,n.mozImageSmoothingEnabled=!1,n.webkitImageSmoothingEnabled=!1,n.msImageSmoothingEnabled=!1,n.imageSmoothingEnabled=!1,{zoomWidth:r,zoomHeight:a}}function v(e,t,o){var i=e.canvas,n=e._zoom,r=e.width,a=e.height,c=e._x,d=e._y;return c<t&&t<c+r*n&&d<o&&o<d+a*n?(i.style.cursor="move",!0):!(i.style.cursor="default")}var m=!1,C=0,x=0;function l(d){return function(e){var t=p(e),o=d.canvas,i=d._x,n=d._y,r=f(o,t.clientX,t.clientY),a=r.x,c=r.y;m=v(d,a,c),C=a-i,x=c-n,d.isDragging=m}}function j(l){return function(e){var t=p(e),o=l.canvas,i=l.width,n=l.height,r=l.cropperWidth,a=l.cropperHeight,c=l._zoom,d=f(o,t.clientX,t.clientY),h=d.x,s=d.y,u=(r-i)*c,g=(a-n)*c;v(l,h,s),m&&(l._x=Math.max(0,Math.min(u,h-C)),l._y=Math.max(0,Math.min(g,s-x)),l._redraw())}}function S(t){return function(e){t.isDragging=m=!1,t._redraw()}}var W=String.prototype.toLowerCase;function z(){throw a(jc,"imgLoaded"),new Error("Load image fail, please check your image")}function I(e){if(e._sourceImg){!function(e){if(e._sourceImg){var t=e.cropperWidth,o=e.cropperHeight,i=e._zoom,n=e._sourceImg,r=n.width,a=n.height,c=Math.min(t/r,o/a);Object.assign(e,{_imgWidth:r*c*i,_imgHeight:a*c*i})}}(e);var t=e.bufferCanvas,o=e._sourceImg,i=e.cropperWidth,n=e.cropperHeight,r=e._imgWidth,a=e._imgHeight,c=e._zoom,d=o.width,h=o.height,s=t.getContext("2d"),u=(i*c-r)/2,g=(n*c-a)/2;s.clearRect(0,0,i*c,n*c),s.drawImage(o,0,0,d,h,u,g,r,a)}}function e(e){this._init(e)}var T,H,L,O;return e.prototype._init=function(e){var t=this;t._originOpts=e,Object.assign(t,d,e),t._uid=h++,t._initCanvas(),t._observeImg(),t._redraw(),t._bindDrag(),a(t,"created")},(T=e).prototype.update=function(e){Object.assign(this,e),this._redraw()},T.prototype.destroy=function(){var e=this;a(e,"beforeDestory"),function(e,t,o,i){void 0===i&&(i=!1);for(var n=u.length,r=[];n--;){var a=u[n],c=a.el,d=a.type,h=a.handler,s=a.options;(!e||e===c&&void 0===t||void 0===o&&t===d&&e===c||void 0===i&&t===d&&o===h&&e===c||t===d&&o===h&&i===s&&e===c)&&(r.push(n),c.removeEventListener(d,h,s))}r.forEach(function(e){u.splice(e,1)})}(),e.canvas=e.bufferCanvas=e._sourceImg=e._originOpts=null,a(e,"destoryed"),e=null},T.prototype.reset=function(){r(this),this._redraw()},T.prototype.cut=function(){var e=this,t=e._sourceImg,o=e._imgWidth,i=e._imgHeight,n=e._zoom,r=e.cropperWidth,a=e.cropperHeight,c=e.width,d=e.height,h=e._x,s=e._y,u=e.imgType,g=e.quality,l=(r*n-o)/2,f=(a*n-i)/2,p=t.width,v=t.height,m=document.createElement("canvas"),_=m.getContext("2d");m.width=r*n,m.height=a*n,m.style.width=r+"px",m.style.height=a+"px",_.drawImage(t,0,0,p,v,l,f,o,i);var y=document.createElement("canvas"),b=y.getContext("2d");return y.width=c*n,y.height=d*n,y.style.width=c+"px",y.style.height=d+"px",b.putImageData(_.getImageData(h,s,c*n,d*n),0,0),y.toDataURL(u,g)},(H=e).prototype._initCanvas=function(){a(this,"beforeCreate");var e,t=this.el;"string"===i(t)?e=document.querySelector(t):"object"===i(t)&&"canvas"===toLowerCase.call(t.nodeName)&&1===t.nodeType&&(e=t),e||((e=document.createElement("canvas")).innerHTML="Your browser does not support canvas");var o="string"===i(t)?document.querySelector(t):t||null;o&&"object"===i(o)&&1===o.nodeType&&o.appendChild(e),this.canvas=e},H.prototype._resizeCanvas=function(){var e=this.canvas,t=this._zoom,o=this.cropperWidth,i=this.cropperHeight;g(e,o,i,t),e.style.width=o+"px",e.style.height=i+"px"},H.prototype._offscreenBuffering=function(){var e=this,t=e.bufferCanvas||document.createElement("canvas"),o=t.getContext("2d"),i=e._zoom,n=g(t,e.cropperWidth,e.cropperHeight,i),r=n.zoomWidth,a=n.zoomHeight;o.clearRect(0,0,r,a),o.save(),o.fillStyle=e.shadowColor,o.fillRect(0,0,r,a),o.restore(),e.bufferCanvas||(e.bufferCanvas=t)},H.prototype._renderOffScreen=function(){var e=this,t=e.bufferCanvas,o=e.canvas,i=e.cropperWidth,n=e.cropperHeight,r=e._zoom,a=o.getContext("2d"),c=i*r,d=n*r;a.clearRect(0,0,c,d),a.drawImage(t,0,0,c,d,0,0,c,d)},e.prototype._bindDrag=function(){var e=this;o(window,"mousedown",l(e),!1),o(window,"mousemove",j(e),!1),o(window,"mouseup",S(e),!1),o(window,"touchstart",l(e),!1),o(window,"touchmove",j(e),!1),o(window,"touchend",S(e),!1)},O=null,(L=e).prototype._observeImg=function(){var t=this;Object.defineProperty(t,"_img",{set:function(e){e!==O&&(O=e,t._redraw())},get:function(){return O}})},L.prototype._redraw=function(){var e=this;e._zoom=function(){var e=document.createElement("canvas"),t=e.getContext("2d");return e=null,(window.devicePixelRatio||1)/(t.backingStorePixelRatio||t.webkitBackingStorePixelRadio||t.mozBackingStorePixelRadio||t.msBackingStorePixelRadio||t.oBackingStorePixedRadio||1)}(),e._resizeCanvas(),e._offscreenBuffering(e),function(e){var t=e.img;if(t&&t!==e._img)if(a(e,"beforeImgLoaded"),"string"===i(t)){var o=new Image;o.onload=function(){e._sourceImg=o,e._img=t,a(e,"imgLoaded")},o.onerror=z,o.src=t}else"object"===i(t)&&"img"===W.call(t)&&1===t.nodeType?(t.onload=function(){e._sourceImg=t,e._img=t,a(e,"imgLoaded")},t.onerror=z):z()}(e),I(e),n(e),e._renderOffScreen(),a(e,"onUpdate")},e.version="1.0.0",e});
