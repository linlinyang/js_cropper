!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).JSCropper=t()}(this,function(){"use strict";var t=Object.prototype.toString;function a(e){return{"[object Object]":"object","[object Array]":"array","[object Number]":"number","[object Boolean]":"boolean","[object String]":"string","[object Function]":"function","[object Undefined]":"undefined","[object Null]":"null"}[t.call(e)]}var c=Object.prototype.hasOwnProperty;function d(e,t){var o=e[t];"function"==typeof o&&o.call(e)}"function"!==a(Object.assign)&&Object.defineProperty(Object,"assign",{value:function(e){var t=arguments;if(null===r)return r;for(var o=arguments.length,r=Object(e),n=1;n<o;n++){var i=t[n];for(var a in i)c.call(i,a)&&(r[a]=i[a])}return r},writable:!0,configurable:!0,enumerable:!1});var o=1;function l(e,t,o,r){void 0===r&&(r=1);var n=e.getContext("2d"),i=t*r,a=o*r;return e.width=i,e.height=a,n.mozImageSmoothingEnabled=!1,n.webkitImageSmoothingEnabled=!1,n.msImageSmoothingEnabled=!1,n.imageSmoothingEnabled=!1,{zoomWidth:i,zoomHeight:a}}var r=String.prototype.toLowerCase;function n(){throw d(jc,"imgLoaded"),new Error("Load image fail, please check your image")}function e(e){this._init(e)}var i,g,p;return e.prototype._init=function(e){var t=this;t._originOpts=e,Object.assign(t,{maxSize:2e3,cropperWidth:800,cropperHeight:600,width:300,height:300,shadowColor:"rgba(0,0,0,0.7)",edgeLineColor:"#fff",edgeLineWidth:3,dashLineColor:"rgba(255,255,255,0.8)",quality:1,imgType:"image/png",inSelectBackColor:"rgba(0,0,0,0.6)",selectBackColor:"rgba(0,0,0,0.2)",scalable:!0,scaleStep:.02},e),t._uid=o++,t._redraw(),d(t,"created")},e.prototype.destroy=function(){d(this,"beforeDestory")},(i=e).prototype._restore=function(){var e=this,t=e.ctx,o=e.cropperWidth*e._zoom,r=e.cropperHeight*e._zoom;e._imageSource=t.getImageData(0,0,o,r)},i.prototype._initCanvas=function(){var e=this;d(e,"beforeCreate");var t,o=e.el;"string"===a(o)?t=document.querySelector(o):"object"===a(o)&&"canvas"===toLowerCase.call(o.nodeName)&&1===o.nodeType&&(t=o),t||((t=document.createElement("canvas")).innerHTML="Your browser does not support canvas");var r=e._zoom,n=e.cropperWidth,i=e.cropperHeight;l(t,n,i,r),t.style.width=n+"px",t.style.height=i+"px",t.parentNode||document.body.appendChild(t),e.canvas=t},i.prototype._offscreenBuffering=function(){var e=this,t=document.createElement("canvas"),o=t.getContext("2d"),r=e._zoom,n=l(t,e.cropperWidth,e.cropperHeight,r),i=n.zoomWidth,a=n.zoomHeight;o.clearRect(0,0,i,a),o.save(),o.fillStyle=e.shadowColor,o.fillRect(0,0,i,a),o.restore(),e.bufferCanvas=t,document.body.appendChild(t)},p=null,(g=e).prototype._redraw=function(){var t=this;t._zoom=function(){var e=document.createElement("canvas"),t=e.getContext("2d");return e=null,(window.devicePixelRatio||1)/(t.backingStorePixelRatio||t.webkitBackingStorePixelRadio||t.mozBackingStorePixelRadio||t.msBackingStorePixelRadio||t.oBackingStorePixedRadio||1)}(),t._initCanvas(),t._offscreenBuffering(t),Object.defineProperty(t,"_img",{set:function(e){e!==p&&(t._img=p=e,function(e){var t=e._targetImg,o=t.width,r=t.height,n=e.cropperWidth,i=e.cropperHeight,a=e._zoom,c=n*a,d=i*a,l=o*a,g=r*a,p=Math.max(l/n,g/i);console.log(l/n,g/i),l/=p,g/=p;var s=document.createElement("canvas"),u=s.getContext("2d");s.width=c,s.height=d,u.drawImage(t,0,0,o,o,0,0,l,g),document.body.appendChild(s)}(t),function(e){var t=e._targetImg;console.log(t.width,t.height)}(t))},get:function(){return p}}),function(e){var t=e.img||e.image;if(t&&t!==e._img)if(d(e,"beforeImgLoaded"),"string"===a(t)){var o=new Image;o.onload=function(){e._targetImg=o,e._img=t},o.onerror=n,o.src=t}else"object"===a(t)&&"img"===r.call(t)&&1===t.nodeType?(t.onload=function(){e._targetImg=t,e._img=t},t.onerror=n):n()}(t)},g.prototype.update=function(e){callHook(this,"beforeUpdate"),0!==Object.keys(e)&&(Object.assign(this,e),this._redraw(),callHook(this,"updated"))},g.prototype.reset=function(){callHook(this,"beforeReset")},e.version="1.0.0",e});
