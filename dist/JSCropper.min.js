!function(e,o){"object"==typeof exports&&"undefined"!=typeof module?module.exports=o():"function"==typeof define&&define.amd?define(o):(e=e||self).JSCropper=o()}(this,function(){"use strict";var o=Object.prototype.toString;function a(e){return{"[object Object]":"object","[object Array]":"array","[object Number]":"number","[object Boolean]":"boolean","[object String]":"string","[object Function]":"function","[object Undefined]":"undefined","[object Null]":"null"}[o.call(e)]}var c=Object.prototype.hasOwnProperty;function d(e,o){var t=e[o];"function"==typeof t&&t.call(e)}"function"!==a(Object.assign)&&Object.defineProperty(Object,"assign",{value:function(e){var o=arguments;if(null===r)return r;for(var t=arguments.length,r=Object(e),i=1;i<t;i++){var n=o[i];for(var a in n)c.call(n,a)&&(r[a]=n[a])}return r},writable:!0,configurable:!0,enumerable:!1});var t=1;function g(e,o,t,r){void 0===r&&(r=1);var i=e.getContext("2d"),n=o*r,a=t*r;return e.width=n,e.height=a,i.mozImageSmoothingEnabled=!1,i.webkitImageSmoothingEnabled=!1,i.msImageSmoothingEnabled=!1,i.imageSmoothingEnabled=!1,{zoomWidth:n,zoomHeight:a}}var r=String.prototype.toLowerCase;function i(){throw d(jc,"imgLoaded"),new Error("Load image fail, please check your image")}function p(e,o){return Math.floor(e)+o%2/2}function f(e,o,t,r,i,n,a){void 0===n&&(n=!1),void 0===a&&(a=!1);var c=e.lineWidth,d=o+r,g=t+i;a&&(o=p(o,c),t=p(t,c),d=p(o+r,c),g=p(t+i,c)),n?(e.moveTo(o,t),e.lineTo(o,g),e.lineTo(d,g),e.lineTo(d,t)):(e.moveTo(o,t),e.lineTo(d,t),e.lineTo(d,g),e.lineTo(o,g)),e.lineTo(o,t)}function n(e){var o=e.bufferCanvas,t=e._x,r=e._y;void 0!==t&&void 0!==r||function(e){var o=e.width,t=e.height,r=e._zoom,i=e.cropperWidth,n=e.cropperHeight;e._x=(i-o)*r/2,e._y=(n-t)*r/2}(e);var i=o.getContext("2d");i.save(),function(e){var o=e.bufferCanvas,t=e.cropperWidth,r=e.cropperHeight,i=e.width,n=e.height,a=e._x,c=e._y,d=e._zoom,g=e.isDragging,p=o.getContext("2d");p.save(),p.beginPath(),f(p,0,0,t*d,r*d),f(p,a,c,i*d,n*d,!0),p.fillStyle=g?e.selectBackColor:e.inSelectBackColor,p.fill(),p.restore()}(e),function(e){var o=e.bufferCanvas,t=(e.cropperWidth,e.cropperHeight,e.width),r=e.height,i=e._x,n=e._y,a=e._zoom,c=(e.edgeLineColor,o.getContext("2d"));c.save(),c.lineWidth=1,c.strokeStyle="red",c.beginPath(),f(c,i,n,t*a,r*a,!0,!0),c.stroke(),c.restore()}(e),i.restore()}function e(e){this._init(e)}var l,s,u;return e.prototype._init=function(e){var o=this;o._originOpts=e,Object.assign(o,{cropperWidth:800,cropperHeight:600,width:300,height:300,shadowColor:"rgba(0,0,0,0.7)",edgeLineColor:"#fff",edgeLineWidth:3,dashLineColor:"rgba(255,255,255,0.8)",quality:1,imgType:"image/png",inSelectBackColor:"rgba(0,0,0,0.6)",selectBackColor:"rgba(0,0,0,0.2)"},e),o._uid=t++,o._redraw(),d(o,"created")},(l=e).prototype.update=function(e){var o=this;d(o,"beforeUpdate"),0!==Object.keys(e)&&(Object.assign(o,e),o._redraw(),d(o,"updated"))},l.prototype.destroy=function(){d(this,"beforeDestory")},l.prototype.reset=function(){d(this,"beforeReset")},(s=e).prototype._restore=function(){var e=this,o=e.ctx,t=e.cropperWidth*e._zoom,r=e.cropperHeight*e._zoom;e._imageSource=o.getImageData(0,0,t,r)},s.prototype._initCanvas=function(){var e=this;d(e,"beforeCreate");var o,t=e.el;"string"===a(t)?o=document.querySelector(t):"object"===a(t)&&"canvas"===toLowerCase.call(t.nodeName)&&1===t.nodeType&&(o=t),o||((o=document.createElement("canvas")).innerHTML="Your browser does not support canvas");var r=e._zoom,i=e.cropperWidth,n=e.cropperHeight;g(o,i,n,r),o.style.width=i+"px",o.style.height=n+"px",o.parentNode||document.body.appendChild(o),e.canvas=o},s.prototype._offscreenBuffering=function(){var e=this,o=document.createElement("canvas"),t=o.getContext("2d"),r=e._zoom,i=g(o,e.cropperWidth,e.cropperHeight,r),n=i.zoomWidth,a=i.zoomHeight;t.clearRect(0,0,n,a),t.save(),t.fillStyle=e.shadowColor,t.fillRect(0,0,n,a),t.restore(),e.bufferCanvas=o,document.body.appendChild(o)},s.prototype._renderOffScreen=function(){var e=this,o=e.bufferCanvas,t=e.canvas,r=e.cropperWidth,i=e.cropperHeight,n=e._zoom,a=t.getContext("2d"),c=r*n,d=i*n;a.clearRect(0,0,c,d),a.drawImage(o,0,0,c,d,0,0,c,d)},u=null,e.prototype._redraw=function(){var o=this;o._zoom=function(){var e=document.createElement("canvas"),o=e.getContext("2d");return e=null,(window.devicePixelRatio||1)/(o.backingStorePixelRatio||o.webkitBackingStorePixelRadio||o.mozBackingStorePixelRadio||o.msBackingStorePixelRadio||o.oBackingStorePixedRadio||1)}(),o._initCanvas(),o._offscreenBuffering(o),Object.defineProperty(o,"_img",{set:function(e){e!==u&&(o._img=u=e,function(e){var o=e.cropperWidth,t=e.cropperHeight,r=e._zoom,i=e._sourceImg,n=i.width,a=i.height,c=Math.min(o/n,t/a);Object.assign(e,{_imgWidth:n*c*r,_imgHeight:a*c*r})}(o),function(e){var o=e.bufferCanvas,t=e._sourceImg,r=e.cropperWidth,i=e.cropperHeight,n=e._imgWidth,a=e._imgHeight,c=e._zoom,d=t.width,g=t.height,p=(r*c-n)/2,f=(i*c-a)/2;o.getContext("2d").drawImage(t,0,0,d,g,p,f,n,a)}(o),n(o),o._renderOffScreen())},get:function(){return u}}),function(e){var o=e.img||e.image;if(o&&o!==e._img)if(d(e,"beforeImgLoaded"),"string"===a(o)){var t=new Image;t.onload=function(){e._sourceImg=t,e._img=o},t.onerror=i,t.src=o}else"object"===a(o)&&"img"===r.call(o)&&1===o.nodeType?(o.onload=function(){e._sourceImg=o,e._img=o},o.onerror=i):i()}(o)},e.version="1.0.0",e});
