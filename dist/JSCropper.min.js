!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).JSCropper=t()}(this,function(){"use strict";var t=Object.prototype.toString;function i(e){return{"[object Object]":"object","[object Array]":"array","[object Number]":"number","[object Boolean]":"boolean","[object String]":"string","[object Function]":"function","[object Undefined]":"undefined","[object Null]":"null"}[t.call(e)]}var c=Object.prototype.hasOwnProperty;function r(e,t){var o=e[t];"function"==typeof o&&o.call(e)}"function"!==i(Object.assign)&&Object.defineProperty(Object,"assign",{value:function(e){var t=arguments;if(null===i)return i;for(var o=arguments.length,i=Object(e),r=1;r<o;r++){var n=t[r];for(var a in n)c.call(n,a)&&(i[a]=n[a])}return i},writable:!0,configurable:!0,enumerable:!1});var o=1;function d(e,t,o,i){void 0===i&&(i=1);var r=e.getContext("2d"),n=t*i,a=o*i;return e.width=n,e.height=a,r.mozImageSmoothingEnabled=!1,r.webkitImageSmoothingEnabled=!1,r.msImageSmoothingEnabled=!1,r.imageSmoothingEnabled=!1,{zoomWidth:n,zoomHeight:a}}var n=String.prototype.toLowerCase;function a(){throw r(jc,"imgLoaded"),new Error("Load image fail, please check your image")}function h(e,t){return Math.floor(e)+t%2/2}function b(e,t,o,i){void 0===i&&(i=!1);var r=e.lineWidth;i?e.moveTo(h(t,r),h(o,r)):e.moveTo(t,o)}function _(e,t,o,i){void 0===i&&(i=!1);var r=e.lineWidth;i?e.lineTo(h(t,r),h(o,r)):e.lineTo(t,o)}function y(e,t,o,i,r,n,a){void 0===n&&(n=!1),void 0===a&&(a=!1);var c=e.lineWidth,d=t+i,s=o+r;a&&(t=h(t,c),o=h(o,c),d=h(t+i,c),s=h(o+r,c)),n?(e.moveTo(t,o),e.lineTo(t,s),e.lineTo(d,s),e.lineTo(d,o)):(e.moveTo(t,o),e.lineTo(d,o),e.lineTo(d,s),e.lineTo(t,s)),e.closePath()}function C(e,t,o,i,r,n,a){void 0===n&&(n=5),void 0===a&&(a=!1);for(var c=function(e,t,o,i){return Math.sqrt(Math.pow(o-e,2)+Math.pow(i-t,2))}(t,o,i,r),d=Math.floor(c/n),s=(i-t)/d,h=(r-o)/d,f=0;f<d;f++){var p=t+f*s,l=o+f*h;1&f?_(e,p,l,a):b(e,p,l,a)}}function s(e){var t=e.bufferCanvas,o=e._x,i=e._y;e._zoom;void 0!==o&&void 0!==i||function(e){var t=e.width,o=e.height,i=e._zoom,r=e.cropperWidth,n=e.cropperHeight;e._x=(r-t)*i/2,e._y=(n-o)*i/2}(e);var r=t.getContext("2d");r.save(),function(e){var t=e.bufferCanvas,o=e.cropperWidth,i=e.cropperHeight,r=e.width,n=e.height,a=e._x,c=e._y,d=e._zoom,s=e.isDragging,h=t.getContext("2d");h.save(),h.beginPath(),y(h,0,0,o*d,i*d),y(h,a,c,r*d,n*d,!0),h.fillStyle=s?e.selectBackColor:e.inSelectBackColor,h.fill(),h.restore()}(e),function(e){var t=e.bufferCanvas,o=e.width,i=e.height,r=e._x,n=e._y,a=e._zoom,c=e.edgeLineColor,d=e.edgeLineWidth,s=t.getContext("2d"),h=o*a,f=i*a;s.strokeStyle=c,s.save(),s.lineWidth=Math.pow(a,2),y(s,r,n,h,f,!1,!0),C(s,r,n+f/3,r+h,n+f/3,5*a,!0),C(s,r,n+2*f/3,r+h,n+2*f/3,5*a,!0),C(s,r+h/3,n,r+h/3,n+f,5*a,!0),C(s,r+2*h/3,n,r+2*h/3,n+f,5*a,!0),s.stroke(),s.restore(),s.save();var p=d*a,l=r-(s.lineWidth=p)/2,g=n-p/2+1,u=r+h+p/2,v=n+f+p/2,m=.1*Math.min(h,f);s.beginPath(),b(s,l,g,!0),_(s,l+m,g,!0),b(s,u-m,g,!0),_(s,u,g,!0),_(s,u,g+m,!0),b(s,u,v-m,!0),_(s,u,v,!0),_(s,u-m,v,!0),b(s,l+m,v,!0),_(s,l,v,!0),_(s,1+l,v-m,!0),b(s,1+l,g+m,!0),_(s,1+l,g-p/2,!0),s.stroke(),s.restore()}(e),r.restore()}function e(e){this._init(e)}var f,p,l,g,u;return e.prototype._init=function(e){var t=this;t._originOpts=e,Object.assign(t,{cropperWidth:800,cropperHeight:600,width:300,height:300,shadowColor:"rgba(0,0,0,0.7)",edgeLineColor:"#fff",edgeLineWidth:3,dashLineColor:"rgba(255,255,255,0.8)",quality:1,imgType:"image/png",inSelectBackColor:"rgba(0,0,0,0.6)",selectBackColor:"rgba(0,0,0,0.2)"},e),t._uid=o++,t._initCanvas(),t._redraw(),r(t,"created")},(f=e).prototype.update=function(e){r(this,"beforeUpdate"),0!==Object.keys(e)&&(Object.assign(this,e),this._redraw(),r(this,"updated"))},f.prototype.destroy=function(){r(this,"beforeDestory"),this.off()},f.prototype.reset=function(){r(this,"beforeReset")},(p=e).prototype._restore=function(){var e=this,t=e.ctx,o=e.cropperWidth*e._zoom,i=e.cropperHeight*e._zoom;e._imageSource=t.getImageData(0,0,o,i)},p.prototype._initCanvas=function(){r(this,"beforeCreate");var e,t=this.el;"string"===i(t)?e=document.querySelector(t):"object"===i(t)&&"canvas"===toLowerCase.call(t.nodeName)&&1===t.nodeType&&(e=t),e||((e=document.createElement("canvas")).innerHTML="Your browser does not support canvas");var o="string"===i(t)?document.querySelector(t):t||null;o&&"object"===i(o)&&1===o.nodeType&&o.appendChild(e),this.canvas=e},p.prototype._resizeCanvas=function(){var e=this.canvas,t=this._zoom,o=this.cropperWidth,i=this.cropperHeight;d(e,o,i,t),e.style.width=o+"px",e.style.height=i+"px"},p.prototype._offscreenBuffering=function(){var e=this,t=document.createElement("canvas"),o=t.getContext("2d"),i=e._zoom,r=d(t,e.cropperWidth,e.cropperHeight,i),n=r.zoomWidth,a=r.zoomHeight;o.clearRect(0,0,n,a),o.save(),o.fillStyle=e.shadowColor,o.fillRect(0,0,n,a),o.restore(),e.bufferCanvas=t,document.body.appendChild(t)},p.prototype._renderOffScreen=function(){var e=this,t=e.bufferCanvas,o=e.canvas,i=e.cropperWidth,r=e.cropperHeight,n=e._zoom,a=o.getContext("2d"),c=i*n,d=r*n;a.clearRect(0,0,c,d),a.drawImage(t,0,0,c,d,0,0,c,d)},g=[],(l=e).prototype.on=function(e,t,o){void 0===o&&(o=!1);var i=this.canvas;void 0!==e&&void 0!==t&&(i.addEventListener(e,t,o),catcheEvents.push({type:e,handler:t,options:o}))},l.prototype.off=function(e,t,o){void 0===o&&(o=!1);for(var i=this.canvas,r=g.length,n=[];r--;){var a=g[r],c=a.type,d=a.handler,s=a.options;(void 0===e||void 0===t&&e===c||void 0===o&&e===c&&t===d||e===c&&t===d&&o===s)&&(n.push(r),i.removeEventListener(c,d,s))}n.forEach(function(e){g.splice(e,1)})},u=null,e.prototype._redraw=function(){var t=this;t._zoom=function(){var e=document.createElement("canvas"),t=e.getContext("2d");return e=null,(window.devicePixelRatio||1)/(t.backingStorePixelRatio||t.webkitBackingStorePixelRadio||t.mozBackingStorePixelRadio||t.msBackingStorePixelRadio||t.oBackingStorePixedRadio||1)}(),t._resizeCanvas(),t._offscreenBuffering(t),Object.defineProperty(t,"_img",{set:function(e){e!==u&&(t._img=u=e,function(e){var t=e.cropperWidth,o=e.cropperHeight,i=e._zoom,r=e._sourceImg,n=r.width,a=r.height,c=Math.min(t/n,o/a);Object.assign(e,{_imgWidth:n*c*i,_imgHeight:a*c*i})}(t),function(e){var t=e.bufferCanvas,o=e._sourceImg,i=e.cropperWidth,r=e.cropperHeight,n=e._imgWidth,a=e._imgHeight,c=e._zoom,d=o.width,s=o.height,h=t.getContext("2d"),f=(i*c-n)/2,p=(r*c-a)/2;h.clearRect(0,0,i*c,r*c),h.drawImage(o,0,0,d,s,f,p,n,a)}(t),s(t),t._renderOffScreen())},get:function(){return u}}),function(e){var t=e.img||e.image;if(t&&t!==e._img)if(r(e,"beforeImgLoaded"),"string"===i(t)){var o=new Image;o.onload=function(){e._sourceImg=o,e._img=t},o.onerror=a,o.src=t}else"object"===i(t)&&"img"===n.call(t)&&1===t.nodeType?(t.onload=function(){e._sourceImg=t,e._img=t},t.onerror=a):a()}(t),s(t),t._renderOffScreen()},e.version="1.0.0",e});
